---
title: Vue SSR 是什么？解决了哪些问题？有做过 SSR 吗？
tags: [Vue, SSR, SEO, 服务端渲染]
---

# 🚀 Vue SSR 是什么？

Vue SSR（Server-Side Rendering）是指在服务端把 Vue 组件渲染为 HTML 字符串，返回给浏览器，然后客户端再激活这些静态内容成为可交互的 SPA 应用。

Vue SSR 的渲染结构包含两部分：

1. **服务端**：生成完整的 HTML 页面（首屏）
2. **客户端**：激活 Vue 应用，挂载事件等（Hydration）

---

# 🧩 SSR 解决了哪些问题？

## ✅ 1. 首屏加载速度提升

- SSR 页面已包含结构化 HTML，用户打开页面可直接看到内容，不必等待 JS 下载、执行、渲染。
- 适用于首屏加载较重的页面、复杂表单或电商首页等场景。

## ✅ 2. 更好的 SEO 支持

- 搜索引擎（如 Google、Bing）更擅长爬取 SSR 渲染的静态 HTML。
- SPA 中通过 JS 生成的内容通常无法被正常索引。

---

# ⚙️ SSR 的实现方式（Vue）

Vue 提供了官方支持的服务端渲染库 [`vue-server-renderer`](https://ssr.vuejs.org/zh/)

SSR 应用通常包含：

- 服务端入口：`server-entry.js`
- 客户端入口：`client-entry.js`
- 同构组件：同时适配服务端与客户端
- Webpack 双端构建配置

## ✍️ SSR 渲染流程

```text
用户请求页面
→ Node 服务器运行 Vue 应用并生成 HTML
→ 将 HTML 返回给浏览器展示（首屏）
→ 加载 JS 文件，客户端激活应用（Hydration）
→ 页面变为可交互的 SPA
````

---

# 💥 SSR 的挑战与缺点

## 1️⃣ 项目复杂度提升

* 需要编写双端入口文件
* Webpack 配置需分别处理 server/client bundle
* Vue 组件需支持同构写法（不能直接操作 `window`、`document`）

## 2️⃣ 第三方库兼容性问题

* 部分库依赖 DOM、浏览器 API，在服务端无法运行（如 Element UI 中部分组件）
* 需加 `if (process.client)` 或 `typeof window !== 'undefined'` 判断

## 3️⃣ 性能开销大

* 每次请求都要新建 Vue 实例，防止用户状态污染
* SSR 是 CPU 密集型，渲染成本远高于静态文件服务
* 需要缓存策略来缓解（如 LRU 缓存、Nginx 缓存）

## 4️⃣ 降级机制复杂

* 当服务器资源占用高（如 CPU/内存爆满），应退回 SPA 模式
* 需监控并接入自动化降级策略

---

# 🧠 你是如何做 Vue SSR 的？

在实际项目中，我做过如下实践：

### 🛠 使用 Nuxt.js 实现 SSR 项目

* Nuxt 默认开启 SSR 模式，简化配置与目录结构
* 配合服务端中间件实现首屏数据预加载
* 使用 `asyncData` 和 `fetch` 实现在服务端请求接口，注入数据
* 使用 `vuex` 管理数据同步

### 🔐 Token 处理与鉴权

* 服务端根据请求头中的 cookie/token 鉴权，返回登录态页面或跳转
* 客户端激活后，与服务端状态保持一致

### 🚧 遇到的问题与解决方案

| 问题                  | 解决方式                                  |
| ------------------- | ------------------------------------- |
| 页面白屏 / Hydration 警告 | 组件内容不一致，避免副作用操作                       |
| Cookie 丢失           | SSR 中使用服务端请求上下文 (`ctx.req`) 读取 cookie |
| SEO 不生效             | 确保 `meta` 信息通过服务端注入 `<head>` 中        |

---

# 📦 SSR 中的缓存策略

为了避免每次都重复渲染，可以使用：

* **Node 层缓存**（如 LRU cache，缓存渲染好的 HTML）
* **Nginx 缓存**（静态内容缓存策略）
* **分段渲染 + CDN 缓存**（头部和脚部内容缓存）

---

# 🔁 SSR 与 CSR（SPA）的比较

| 项目    | SSR        | SPA         |
| ----- | ---------- | ----------- |
| 首屏速度  | 快          | 慢（等待 JS 执行） |
| SEO   | 好          | 差           |
| 服务器压力 | 高          | 低           |
| 适用场景  | 资讯、博客、首屏优化 | 后台管理系统      |
| 开发复杂度 | 高          | 低           |

---

# 💡 总结一句话

> Vue SSR 能解决 SEO 与首屏性能问题，但需权衡性能与开发复杂度，建议针对**首屏优化、SEO 场景**使用 SSR，其它页面保持 CSR 模式。
