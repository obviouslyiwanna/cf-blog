---
title: Loader å’Œ Plugin çš„åŒºåˆ«ä¸ç¼–å†™æ€è·¯
description: æœ¬æ–‡å¯¹æ¯” Webpack ä¸­ Loader ä¸ Plugin çš„æœ¬è´¨å·®å¼‚ï¼Œå¹¶è¯¦ç»†ä»‹ç»å¦‚ä½•è‡ªå®šä¹‰å®ç°ä¸€ä¸ª Loader ä¸ Plugin çš„åŸºæœ¬æ­¥éª¤ä¸è§„èŒƒã€‚
tags: [Webpack, Loader, Plugin, æ„å»ºå·¥å…·, å‰ç«¯å·¥ç¨‹åŒ–]
---

# Loader å’Œ Plugin çš„åŒºåˆ«ä¸ç¼–å†™æ€è·¯

åœ¨ Webpack æ„å»ºä½“ç³»ä¸­ï¼Œ`Loader` ä¸ `Plugin` æ˜¯ä¸¤ä¸ªéå¸¸é‡è¦çš„æ‰©å±•æœºåˆ¶ï¼Œå®ƒä»¬æ‰¿æ‹…ç€ä¸åŒçš„èŒè´£ï¼Œè§£å†³ä¸åŒå±‚æ¬¡çš„é—®é¢˜ã€‚ç†è§£ä¸¤è€…çš„æœ¬è´¨åŒºåˆ«åŠå…¶é€‚ç”¨åœºæ™¯ï¼Œæœ‰åŠ©äºæˆ‘ä»¬ç¼–å†™æ›´åŠ é«˜æ•ˆã€çµæ´»çš„æ„å»ºé…ç½®ï¼Œç”šè‡³å®ç°è‡ªå®šä¹‰çš„æ„å»ºé€»è¾‘ã€‚

---

## ä¸€ã€Loader vs Plugin çš„åŒºåˆ«

| å¯¹æ¯”é¡¹ | Loader | Plugin |
|--------|--------|--------|
| æœ¬è´¨ | æ¨¡å—è½¬æ¢å™¨ï¼ˆtransformerï¼‰ | æ„å»ºæµç¨‹æ‰©å±•å™¨ï¼ˆlifecycle hookï¼‰ |
| æ“ä½œå¯¹è±¡ | å•ä¸ªæ–‡ä»¶æ¨¡å—ï¼ˆå¦‚ `.js`ã€`.css`ã€`.less`ï¼‰ | æ•´ä¸ªæ„å»ºæµç¨‹ |
| è¿è¡Œæ—¶æœº | æ¨¡å—åŠ è½½å‰ï¼ˆloader-chainï¼‰ | æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­ï¼ˆcompileã€emit ç­‰é˜¶æ®µï¼‰ |
| ä½¿ç”¨æ–¹å¼ | é…ç½®äº `module.rules` ä¸­ | é…ç½®äº `plugins` æ•°ç»„ä¸­ |
| ç¤ºä¾‹ | `babel-loader`ã€`css-loader` | `HtmlWebpackPlugin`ã€`DefinePlugin` |
| èƒ½åŠ›èŒƒå›´ | æ–‡ä»¶å†…å®¹çš„ç¼–è¯‘ã€è½¬æ¢ç­‰ | æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰ |
| æ˜¯å¦å¯é“¾å¼è°ƒç”¨ | âœ…ï¼ˆä»å³å¾€å·¦ï¼‰ | âŒï¼ˆæ‰§è¡Œé¡ºåºå—ç”Ÿå‘½å‘¨æœŸæ§åˆ¶ï¼‰ |

ğŸ‘‰ æ€»ç»“ä¸€å¥è¯ï¼š**Loader æ˜¯èµ„æºçº§åˆ«çš„é¢„å¤„ç†å™¨ï¼ŒPlugin æ˜¯æ„å»ºæµç¨‹çº§åˆ«çš„å‚ä¸è€…ã€‚**

---

## äºŒã€å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰ Loaderï¼Ÿ

### 1. Loader æ˜¯ä»€ä¹ˆï¼Ÿ

æœ¬è´¨ä¸Šï¼ŒLoader å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥æ”¶æºæ–‡ä»¶å†…å®¹ä½œä¸ºå‚æ•°ï¼Œè¿”å›è½¬æ¢åçš„å†…å®¹ï¼ˆæˆ–é€šè¿‡ `this.callback` å¼‚æ­¥è¿”å›ï¼‰ã€‚

```js
// my-loader.js
module.exports = function(source) {
  const content = doSomething(source);

  // å¦‚æœæ˜¯å¼‚æ­¥ loader
  this.callback(null, content);

  // åŒæ­¥ä¹Ÿå¯ä»¥ç›´æ¥ return
  // return content;
};
```

### 2. ç¼–å†™è¦ç‚¹

* Loader å‡½æ•°ä¸èƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œå› ä¸ºéœ€è¦è®¿é—® `this`ï¼ˆç”± Webpack æ³¨å…¥ï¼‰ã€‚
* `this.query` å¯è¯»å– loader çš„é…ç½®é¡¹ï¼ˆå¦‚æœæœ‰ä¼ å…¥ optionsï¼‰ã€‚
* æ”¯æŒå¼‚æ­¥å¤„ç†ï¼ˆé€šè¿‡ `this.async()` æˆ– `this.callback()`ï¼‰ã€‚
* ä¿æŒåŠŸèƒ½å•ä¸€ï¼Œä¾¿äºç»„åˆæˆ loader chainã€‚

### 3. ç¤ºä¾‹åœºæ™¯ï¼šè‡ªå®šä¹‰ markdown è½¬ HTML çš„ loader

```js
const marked = require('marked');

module.exports = function(source) {
  const html = marked(source);
  return `export default ${JSON.stringify(html)}`;
};
```

---

## ä¸‰ã€å¦‚ä½•ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰ Pluginï¼Ÿ

### 1. Plugin æ˜¯ä»€ä¹ˆï¼Ÿ

æœ¬è´¨ä¸Šï¼ŒPlugin æ˜¯ä¸€ä¸ªå¸¦æœ‰ `apply(compiler)` æ–¹æ³•çš„ç±»ï¼Œé€šè¿‡ç›‘å¬ Webpack æ„å»ºç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶é’©å­ï¼ˆHooksï¼‰ï¼Œæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

### 2. ç¼–å†™è§„èŒƒ

* å¿…é¡»æ˜¯ä¸€ä¸ªç±»ï¼Œæä¾› `apply` æ–¹æ³•ã€‚
* åœ¨ `apply` æ–¹æ³•ä¸­æ³¨å†Œæ„Ÿå…´è¶£çš„ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚
* å¯é€šè¿‡ `compiler` ä¸ `compilation` è·å–å½“å‰æ„å»ºä¸Šä¸‹æ–‡ã€‚
* è‹¥ä¸ºå¼‚æ­¥æ’ä»¶ï¼Œéœ€è°ƒç”¨å›è°ƒé€šçŸ¥ Webpackã€‚

### 3. ç¤ºä¾‹æ¨¡æ¿

```js
class MyPlugin {
  apply(compiler) {
    compiler.hooks.emit.tap('MyPlugin', compilation => {
      // emit äº‹ä»¶ä»£è¡¨èµ„æºå·²å¤„ç†å®Œï¼Œå³å°†è¾“å‡º
      for (const filename in compilation.assets) {
        console.log(`Processing: ${filename}`);
      }
    });
  }
}
```

### 4. å¸¸ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆéƒ¨åˆ†ï¼‰

| é’©å­å           | è¯´æ˜                    |
| ------------- | --------------------- |
| `entryOption` | åˆå§‹åŒ–é…ç½®                 |
| `run`         | å¼€å§‹ç¼–è¯‘                  |
| `compile`     | ç¼–è¯‘å‰è§¦å‘                 |
| `compilation` | åˆ›å»º compilation å¯¹è±¡     |
| `make`        | ä» entry å¼€å§‹é€’å½’æ„å»ºæ¨¡å—      |
| `emit`        | è¾“å‡º asset åˆ°ç¡¬ç›˜å‰ï¼Œå¸¸ç”¨äºä¿®æ”¹æ–‡ä»¶ |
| `done`        | ç¼–è¯‘å®Œæˆ                  |

---

## å››ã€æ€»ç»“

| ç‰¹æ€§   | Loader      | Plugin                 |
| ---- | ----------- | ---------------------- |
| æ“ä½œç²’åº¦ | å•ä¸ªèµ„æºæ–‡ä»¶      | æ„å»ºè¿‡ç¨‹å…¨å±€                 |
| è®¾è®¡ç›®æ ‡ | æ¨¡å—å†…å®¹é¢„å¤„ç†     | æ„å»ºæµç¨‹æ‰©å±•ä¸å¢å¼º              |
| ç¼–å†™æ–¹å¼ | å¯¼å‡ºå‡½æ•°        | å®šä¹‰ç±»ï¼Œæ³¨å†Œåˆ° compiler.hooks |
| å¸¸ç”¨åœºæ™¯ | å¤„ç†æ ·å¼ã€å›¾ç‰‡ã€è¯­æ³•ç­‰ | è‡ªåŠ¨ç”Ÿæˆ HTMLã€æ¸…é™¤ç›®å½•ã€å‹ç¼©ä»£ç     |

---

## å‚è€ƒèµ„æº

* [Webpack å®˜æ–¹æ–‡æ¡£ï¼šLoader](https://webpack.js.org/concepts/loaders/)
* [Webpack å®˜æ–¹æ–‡æ¡£ï¼šPlugin](https://webpack.js.org/contribute/writing-a-plugin/)
* [Tapable æºç ä¸ç”Ÿå‘½å‘¨æœŸæœºåˆ¶](https://github.com/webpack/tapable)

